/**
 * @Title: CombatService.java
 * @Package com.game.service
 * @Description:
 * @author ZhangJun
 * @date 2015年8月28日 下午3:34:13
 * @version V1.0
 */
package com.game.service;

import com.game.constant.*;
import com.game.dataMgr.StaticCombatDataMgr;
import com.game.dataMgr.StaticHeroDataMgr;
import com.game.dataMgr.StaticVipDataMgr;
import com.game.domain.Player;
import com.game.domain.p.*;
import com.game.domain.s.*;
import com.game.fight.FightLogic;
import com.game.fight.domain.Fighter;
import com.game.fight.domain.Force;
import com.game.manager.ActivityDataManager;
import com.game.manager.ExtremeDataManager;
import com.game.manager.PlayerDataManager;
import com.game.manager.RankDataManager;
import com.game.message.handler.ClientHandler;
import com.game.pb.CommonPb;
import com.game.pb.CommonPb.AtkExtreme;
import com.game.pb.CommonPb.Award;
import com.game.pb.GamePb1.*;
import com.game.pb.GamePb2.*;
import com.game.pb.GamePb6;
import com.game.server.GameServer;
import com.game.util.*;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import java.util.*;

/**
 * @author ZhangJun
 * @ClassName: CombatService
 * @Description:副本关卡
 * @date 2015年8月28日 下午3:34:13
 */
@Service
public class CombatService {

    @Autowired
    private StaticCombatDataMgr staticCombatDataMgr;

    @Autowired
    private StaticHeroDataMgr staticHeroDataMgr;

    @Autowired
    private StaticVipDataMgr staticVipDataMgr;

    @Autowired
    private PlayerDataManager playerDataManager;

    @Autowired
    private ActivityDataManager activityDataManager;

    @Autowired
    private ExtremeDataManager extremeDataManager;

    @Autowired
    private RankDataManager rankDataManager;

    @Autowired
    private FightService fightService;

    @Autowired
    private ActivityNewService activityNewService;
    @Autowired
    private TacticsService tacticsService;

    /**
     * Method: getCombat
     *
     * @param handler
     * @return void
     * @Description: 客户端获取副本数据
     */
    public void getCombat(ClientHandler handler) {
        Player player = playerDataManager.getPlayer(handler.getRoleId());
        GetCombatRs.Builder builder = GetCombatRs.newBuilder();

        Iterator<Combat> it = player.combats.values().iterator();
        while (it.hasNext()) {
            builder.addCombat(PbHelper.createCombatPb(it.next()));
        }

        Iterator<Combat> exploreIt = player.explores.values().iterator();
        while (exploreIt.hasNext()) {
            builder.addExplore(PbHelper.createCombatPb(exploreIt.next()));
        }

        for (Map.Entry<Integer, Integer> entry : player.sections.entrySet()) {
            builder.addSection(PbHelper.createSectionPb(entry.getKey(), entry.getValue()));
        }

        builder.setCombatId(player.combatId);
        builder.setEquipEplrId(player.equipEplrId);
        builder.setPartEplrId(player.partEplrId);
        builder.setExtrEplrId(player.extrEplrId);
        builder.setMilitaryEplrId(player.militaryEplrId);
        builder.setTimePrlrId(player.timePrlrId);
        builder.setExtrMark(player.extrMark);
        builder.setEnergyStoneEplrId(player.energyStoneEplrId);
        if (player.wipeTime != 0) {
            builder.setWipeTime(player.wipeTime);
        }
        builder.setMedalEplrId(player.medalEplrId);
        builder.setTacticsId(player.tacticsInfo.getCombatId());
        handler.sendMsgToPlayer(GetCombatRs.ext, builder.build());
    }

    /**
     * Method: haustTank
     *
     * @param player
     * @param fighter
     * @param ratio
     * @return Map<Integer                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               ,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               RptTank>
     * @Description: 副本中的战损，扣除玩家的实际坦克数量 ，添加玩家的修理坦克
     */
    private Map<Integer, RptTank> haustTank(Player player, Fighter fighter, double ratio) {
        Map<Integer, RptTank> map = new HashMap<>();
        Map<Integer, Tank> tanks = player.tanks;
        int killed = 0;
        int tankId = 0;
        for (Force force : fighter.forces) {
            if (force != null) {
                killed = force.killed;
                if (killed > 0) {
                    tankId = force.staticTank.getTankId();
                    RptTank rptTank = map.get(tankId);
                    if (rptTank != null) {
                        rptTank.setCount(rptTank.getCount() + killed);
                    } else {
                        rptTank = new RptTank(tankId, killed);
                        map.put(tankId, rptTank);
                    }
                }
            }
        }

        Iterator<RptTank> it = map.values().iterator();
        while (it.hasNext()) {
            RptTank rptTank = (RptTank) it.next();
            killed = rptTank.getCount();
            int repair = (int) Math.ceil(ratio * killed);
            Tank tank = tanks.get(rptTank.getTankId());
            tank.setRest(tank.getRest() + repair);
            tank.setCount(tank.getCount() - killed);
            LogLordHelper.tank(AwardFrom.DO_COMBAT, player.account, player.lord, tank.getTankId(), tank.getCount(), -killed,
                    repair - killed, 0);
        }

        return map;
    }

    /**
     * Method: doCombat
     *
     * @param req
     * @param handler
     * @return void
     * @Description: 挑战副本
     */
    public void doCombat(DoCombatRq req, ClientHandler handler) {
        boolean wipe = false;

        if (req.hasWipe()) {
            wipe = true;
        }
        int combatId = req.getCombatId();
        CommonPb.Form form = req.getForm();

        // 战斗对象
        StaticCombat staticCombat = staticCombatDataMgr.getStaticCombat(combatId);
        if (staticCombat == null) {
            handler.sendErrorMsgToPlayer(GameError.NO_CONFIG);
            return;
        }

        // 战斗地区
        StaticSection staticSection = staticCombatDataMgr.getStaticSection(staticCombat.getSectionId());
        if (staticSection == null) {
            handler.sendErrorMsgToPlayer(GameError.NO_CONFIG);
            return;
        }

        Player player = playerDataManager.getPlayer(handler.getRoleId());

        // VIP等级是否允许扫荡
        if (wipe) {
            if (player.lord.getVip() < 3) {
                handler.sendErrorMsgToPlayer(GameError.VIP_NOT_ENOUGH);
                return;
            }
        }

        // 前面关卡还没过
        if (combatId != 101) {
            if (player.combatId < staticCombat.getPreId()) {
                handler.sendErrorMsgToPlayer(GameError.COMBAT_PASS_BEFORE);
                return;
            }
        }

        if (player.lord.getRanks() < staticSection.getRank()) {
            handler.sendErrorMsgToPlayer(GameError.NO_RANKS);
            return;
        }

        if (player.lord.getPower() < 1) {
            handler.sendErrorMsgToPlayer(GameError.NO_POWER);
            return;
        }

        Form attackForm = PbHelper.createForm(form);
        StaticHero staticHero = null;
        int heroId = 0;
        AwakenHero awakenHero = null;
        Hero hero = null;
        if (attackForm.getAwakenHero() != null) {// 使用觉醒将领
            awakenHero = player.awakenHeros.get(attackForm.getAwakenHero().getKeyId());
            if (awakenHero == null || awakenHero.isUsed()) {
                handler.sendErrorMsgToPlayer(GameError.NO_HERO);
                return;
            }
            attackForm.setAwakenHero(awakenHero.clone());
            heroId = awakenHero.getHeroId();
        } else if (attackForm.getCommander() > 0) {
            hero = player.heros.get(attackForm.getCommander());
            if (hero == null || hero.getCount() <= 0) {
                handler.sendErrorMsgToPlayer(GameError.NO_HERO);
                return;
            }
            heroId = hero.getHeroId();
        }

        if (heroId != 0) {
            staticHero = staticHeroDataMgr.getStaticHero(heroId);
            if (staticHero == null) {
                handler.sendErrorMsgToPlayer(GameError.NO_CONFIG);
                return;
            }

            if (staticHero.getType() != 2) {
                handler.sendErrorMsgToPlayer(GameError.NOT_HERO);
                return;
            }
        }

        // 使用坦克数量是否超出
        int maxTankCount = playerDataManager.formTankCount(player, staticHero, awakenHero);
        if (!playerDataManager.checkTank(player, attackForm, maxTankCount)) {
            handler.sendErrorMsgToPlayer(GameError.TANK_COUNT);
            return;
        }
        //战术验证
        if (!attackForm.getTactics().isEmpty()) {
            boolean checkUseTactics = tacticsService.checkUseTactics(player, attackForm);
            if (!checkUseTactics) {
                handler.sendErrorMsgToPlayer(GameError.USE_TACTICS_ERROR);
                return;
            }
        }
        Fighter attacker = fightService.createFighter(player, attackForm, AttackType.ACK_COMBIT);
        Fighter npc = fightService.createFighter(staticCombat);

        FightLogic fightLogic = new FightLogic(attacker, npc, FirstActType.ATTACKER, !wipe);
        fightLogic.fight();

        // PVE战斗免伤亡
        double ratio = player.sciences.containsKey(ScienceId.PVE_HAUST_EXEPMT) ? 1.0 : 0.8;
        Map<Integer, RptTank> haust = haustTank(player, attacker, ratio);

        DoCombatRs.Builder builder = DoCombatRs.newBuilder();
        if (fightLogic.getWinState() == 1) {
            boolean firstPass = false;
            if (combatId > player.combatId) {
                firstPass = true;
                player.combatId = combatId;
                LogHelper.logCombat(player);
            }
            int star = fightLogic.estimateStar();
            boolean starChange = false;
            builder.addAllAward(dropCombatAward(player, staticCombat.getDrop()));
            Combat combat = player.combats.get(combatId);
            if (combat == null) {
                combat = new Combat(combatId, star);
                player.combats.put(combatId, combat);
                starChange = true;
                LogUtil.error("");
            } else {
                if (star > combat.getStar()) {
                    combat.setStar(star);
                    starChange = true;
                }
            }
            if (starChange) {// 星数变化 计算总星数 更新排行榜 SetDataHandler type=2中客户端提交的已注释
                int stars = 0;
                for (Combat c : player.combats.values()) {
                    stars += c.getStar();
                }
                player.lord.setStars(stars);
                rankDataManager.setStars(player.lord);

                playerDataManager.updDay7ActSchedule(player, 2, stars);
            }

            if (firstPass) {
                firstAward(player, staticCombat.getFirstAward(), builder);
            }

            playerDataManager.subPower(player.lord, 1);
            int exp = (int) (staticCombat.getExp() * fightService.effectCombatExpAdd(player, staticHero));

            playerDataManager.addExp(player, exp);
            int realExp = playerDataManager.realExp(player, exp);
            builder.setExp(realExp);
            builder.setResult(star);

            playerDataManager.activeBoxDrop(player);

            activityDataManager.updActivity(player, ActivityConst.ACT_COMBAT, 1, 0);
            playerDataManager.updTask(handler.getRoleId(), TaskType.COND_COMBAT, 1, combatId);
            playerDataManager.updTask(handler.getRoleId(), TaskType.COND_LIVE_COMBAT, 1, combatId);// 活跃任务攻打副本任务进度刷新
            List<Integer> prop = activityDataManager.combatCourse(player, staticCombat.getSectionId(), ActivityConst.ACT_COMBAT_INTER);
            if (prop != null) {
                int keyId = playerDataManager.addAward(player, prop.get(0), prop.get(1), prop.get(2), AwardFrom.COMBAT_COURSE);
                builder.addAward(PbHelper.createAwardPb(prop.get(0), prop.get(1), prop.get(2), keyId));
            }
            prop = activityDataManager.combatCourse(player, staticCombat.getSectionId(), ActivityConst.ACT_COMBAT_INTER_NEW);
            if (prop != null) {
                int keyId = playerDataManager.addAward(player, prop.get(0), prop.get(1), prop.get(2), AwardFrom.COMBAT_COURSE);
                builder.addAward(PbHelper.createAwardPb(prop.get(0), prop.get(1), prop.get(2), keyId));
            }
            List<Integer> propEquip = activityDataManager.combatCash(player, ActivityConst.ACT_EQUIP_EXCHANGE_ID,
                    staticCombat.getSectionId());
            List<Integer> propPart = activityDataManager.combatCash(player, ActivityConst.ACT_PART_EXCHANGE_ID,
                    staticCombat.getSectionId());
            List<Integer> propActivity = activityDataManager.combatCash(player, ActivityConst.ACT_COLLECT_CHARACTER,
                    staticCombat.getSectionId());
            List<Integer> actBosspropActivity = activityDataManager.combatCash(player, ActivityConst.ACT_BOSS, staticCombat.getSectionId());
            List<Integer> actHilarityPrayProp = activityDataManager.combatCash(player, ActivityConst.ACT_HILARITY_PRAY_ID,
                    staticCombat.getSectionId());
            List<Integer> festivaProp = activityDataManager.combatCash(player, ActivityConst.ACT_FESTIVAL, staticCombat.getSectionId());
            if (propEquip != null) {
                int keyId = playerDataManager.addAward(player, propEquip.get(0), propEquip.get(1), propEquip.get(2),
                        AwardFrom.EXCHANGE_EQUIP);
                builder.addAward(PbHelper.createAwardPb(propEquip.get(0), propEquip.get(1), propEquip.get(2), keyId));
            }
            if (propPart != null) {
                int keyId = playerDataManager.addAward(player, propPart.get(0), propPart.get(1), propPart.get(2), AwardFrom.EXCHANGE_EQUIP);
                builder.addAward(PbHelper.createAwardPb(propPart.get(0), propPart.get(1), propPart.get(2), keyId));
            }
            if (propActivity != null) {
                playerDataManager.addAward(player, propActivity.get(0), propActivity.get(1), propActivity.get(2), AwardFrom.COMBAT_COURSE);
                builder.addAward(PbHelper.createAwardPb(propActivity.get(0), propActivity.get(1), propActivity.get(2)));
            }
            if (actBosspropActivity != null) {
                playerDataManager.addAward(player, actBosspropActivity.get(0), actBosspropActivity.get(1), actBosspropActivity.get(2),
                        AwardFrom.COMBAT_COURSE);
                builder.addAward(
                        PbHelper.createAwardPb(actBosspropActivity.get(0), actBosspropActivity.get(1), actBosspropActivity.get(2)));
            }
            if (actHilarityPrayProp != null) {
                playerDataManager.addAward(player, actHilarityPrayProp.get(0), actHilarityPrayProp.get(1), actHilarityPrayProp.get(2),
                        AwardFrom.COMBAT_COURSE);
                builder.addAward(
                        PbHelper.createAwardPb(actHilarityPrayProp.get(0), actHilarityPrayProp.get(1), actHilarityPrayProp.get(2)));
            }
            if (festivaProp != null) {
                playerDataManager.addAward(player, festivaProp.get(0), festivaProp.get(1), festivaProp.get(2), AwardFrom.COMBAT_COURSE);
                builder.addAward(PbHelper.createAwardPb(festivaProp.get(0), festivaProp.get(1), festivaProp.get(2)));
            }
        } else {
            builder.setResult(-1);
        }

        Iterator<RptTank> it = haust.values().iterator();
        while (it.hasNext()) {
            builder.addHaust(PbHelper.createRtpTankPb(it.next()));
        }

        if (!wipe) {
            CommonPb.Record record = fightLogic.generateRecord();
            builder.setRecord(record);
        }

        playerDataManager.updTask(handler.getRoleId(), TaskType.COND_ATTACK_COMBAT, 1, combatId);
        handler.sendMsgToPlayer(DoCombatRs.ext, builder.build());
    }

    /**
     * Method: checkExploreLv
     *
     * @param player
     * @param type
     * @return boolean
     * @Description: 检查探险开启等级
     */
    private boolean checkExploreLv(Player player, int type) {
        if (type == ComBatConst.Explore_Equip) {// 装备探险
            if (player.lord.getLevel() < 1) {
                return false;
            }
        } else if (type == ComBatConst.Explore_Part) {// 配件探险
            if (player.lord.getLevel() < 18) {
                return false;
            }
        } else if (type == ComBatConst.Explore_Extreme) {// 极限探险
            if (player.lord.getLevel() < 35) {
                return false;
            }
        } else if (type == ComBatConst.Explore_Military) {// 军工科技
            if (player.lord.getLevel() < 30) {
                return false;
            }
        } else if (type == ComBatConst.Explore_Time) {// 限时副本
            if (player.lord.getLevel() < 8) {
                return false;
            }
        } else if (type == ComBatConst.Explore_EnergyStone) {// 能晶副本
            if (player.lord.getLevel() < 55) {
                return false;
            }
        } else if (type == ComBatConst.Explore_Medal) {// 勋章探险
            if (player.lord.getLevel() < 15) {
                return false;
            }
        } else if (type == ComBatConst.Tactics) {// 勋章探险
            if (player.lord.getLevel() < 40) {
                return false;
            }
        }
        return true;
    }

    /**
     * Method: cleanExplore
     *
     * @param lord
     * @return void
     * @Description: 每天重置次数
     */
    static public void cleanExplore(Lord lord) {
        int day = TimeHelper.getCurrentDay();
        if (lord.getEplrTime() != day) {
            lord.setEquipEplr(0);
            lord.setPartEplr(0);
            lord.setMilitaryEplr(0);
            lord.setExtrEplr(0);
            lord.setTimeEplr(0);
            lord.setEnergyStoneEplr(0);
            lord.setEquipBuy(0);
            lord.setPartBuy(0);
            lord.setMilitaryBuy(0);
            lord.setExtrReset(0);
            lord.setEplrTime(day);
            lord.setEnergyStoneBuy(0);
            lord.setTimeBuy(0);
            lord.setMedalEplr(0);
            lord.setMedalBuy(0);
            lord.setTacticsBuy(0);
            lord.setTacticsReset(0);
        }
    }

    /**
     * Method: checkExploreCount
     *
     * @param player
     * @param type
     * @return boolean
     * @Description: 检查探险次数
     */
    private boolean checkExploreCount(Player player, int type) {
        Lord lord = player.lord;
        cleanExplore(lord);
        if (type == ComBatConst.Explore_Equip) {// 装备探险
            int add = activityDataManager.freeLotEquip();
            if (lord.getEquipEplr() >= (5 + lord.getEquipBuy() * 5 + add)) {
                return false;
            }
        } else if (type == ComBatConst.Explore_Part) {// 配件探险
            int add = activityDataManager.freeLotPart();
            if (lord.getPartEplr() >= (5 + lord.getPartBuy() * 5 + add)) {
                return false;
            }
        } else if (type == ComBatConst.Explore_Military) {// 军工探险
            int add = activityDataManager.freeLotMilitary(); // 活动
            if (lord.getMilitaryEplr() >= (5 + lord.getMilitaryBuy() * 5 + add)) {
                return false;
            }
        } else if (type == ComBatConst.Explore_Extreme) {// 极限探险
            if (lord.getExtrEplr() >= 3) {
                return false;
            }
        } else if (type == ComBatConst.Explore_Time) {// 限时副本
            if (lord.getTimeEplr() >= 5 + lord.getTimeBuy() * 5) {
                return false;
            }
        } else if (type == ComBatConst.Explore_EnergyStone) {// 能晶副本，VIP买一次加5挑战次数
            int add = activityDataManager.freeLotEnergyStone(); // 活动
            if (lord.getEnergyStoneEplr() >= (5 + lord.getEnergyStoneBuy() * 5 + add)) {
                return false;
            }
        } else if (type == ComBatConst.Explore_Medal) {// 勋章探险
            int add = activityDataManager.freeLotMedal();
            if (lord.getMedalEplr() >= (5 + lord.getMedalBuy() * 5 + add)) {
                return false;
            }
        } else if (type == ComBatConst.Tactics) {// 战术探险
            int add = activityDataManager.freeLotTactics();
            if (lord.getTacticsReset() >= (5 + lord.getTacticsBuy() * 5 + add)) {
                return false;
            }
        }
        return true;
    }

    /**
     * Method: checkTime
     *
     * @return boolean
     * @Description: 检查限时副本开启时间
     */
    private boolean checkTime() {
        Calendar calendar = Calendar.getInstance();
        int dayOfWeek = calendar.get(Calendar.DAY_OF_WEEK);
        if (dayOfWeek != Calendar.TUESDAY && dayOfWeek != Calendar.THURSDAY && dayOfWeek != Calendar.SATURDAY) {
            return false;
        }

        // int hour = calendar.get(Calendar.HOUR_OF_DAY);
        // if (hour < 18) {
        // return false;
        // }

        return true;
    }

    /**
     * Method: doExplore
     *
     * @param req
     * @param handler
     * @return void
     * @Description: 探险副本
     */
    public void doExplore(DoCombatRq req, ClientHandler handler) {
        boolean wipe = false;
        if (req.hasWipe()) {
            wipe = true;
        }

        int combatId = req.getCombatId();
        CommonPb.Form form = req.getForm();

        StaticExplore staticExplore = staticCombatDataMgr.getStaticExplore(combatId);
        if (staticExplore == null) {
            handler.sendErrorMsgToPlayer(GameError.NO_CONFIG);
            return;
        }

        Player player = playerDataManager.getPlayer(handler.getRoleId());
        if (wipe) {
            if (player.lord.getVip() < 3) {
                handler.sendErrorMsgToPlayer(GameError.VIP_NOT_ENOUGH);
                return;
            }
        }

        if (!checkExploreLv(player, staticExplore.getType())) {
            handler.sendErrorMsgToPlayer(GameError.LV_NOT_ENOUGH);
            return;
        }

        int exploreType = staticExplore.getType();
        if (exploreType == ComBatConst.Explore_Equip) {// 装备
            if (combatId != 101) {
                if (player.equipEplrId < staticExplore.getPreId()) {
                    handler.sendErrorMsgToPlayer(GameError.COMBAT_PASS_BEFORE);
                    return;
                }
            }

            Map<Integer, Equip> store = player.equips.get(0);
            if (store.size() >= player.lord.getEquip()) {
                handler.sendErrorMsgToPlayer(GameError.MAX_EQUIP_STORE);
                return;
            }
        } else if (exploreType == ComBatConst.Explore_Part) {// 配件
            if (combatId != 201) {
                if (player.partEplrId < staticExplore.getPreId()) {
                    handler.sendErrorMsgToPlayer(GameError.COMBAT_PASS_BEFORE);
                    return;
                }
            }

            Map<Integer, Part> storeMap = player.parts.get(0);
            if (storeMap.size() >= PlayerDataManager.PART_STORE_LIMIT) {
                handler.sendErrorMsgToPlayer(GameError.MAX_PART_STORE);
                return;
            }
        } else if (exploreType == ComBatConst.Explore_Extreme) {
            handler.sendErrorMsgToPlayer(GameError.INVALID_PARAM);
            return;
        } else if (exploreType == ComBatConst.Explore_Time) {// 限时
            if (!checkTime()) {
                handler.sendErrorMsgToPlayer(GameError.COMBAT_NOT_OPEN);
                return;
            }
            if (combatId != 401) {
                if (player.timePrlrId < staticExplore.getPreId()) {
                    handler.sendErrorMsgToPlayer(GameError.COMBAT_PASS_BEFORE);
                    return;
                }
            }
        } else if (exploreType == ComBatConst.Explore_Military) {// 军工副本
            if (combatId != 501) {
                if (player.militaryEplrId < staticExplore.getPreId()) {
                    handler.sendErrorMsgToPlayer(GameError.COMBAT_PASS_BEFORE);
                    return;
                }
            }
        } else if (exploreType == ComBatConst.Explore_EnergyStone) {// 能晶副本
            if (combatId != 801) {
                if (player.energyStoneEplrId < staticExplore.getPreId()) {
                    handler.sendErrorMsgToPlayer(GameError.COMBAT_PASS_BEFORE);
                    return;
                }
            }
        } else if (exploreType == ComBatConst.Explore_Medal) {// 勋章
            if (combatId != 901) {
                if (player.medalEplrId < staticExplore.getPreId()) {
                    handler.sendErrorMsgToPlayer(GameError.COMBAT_PASS_BEFORE);
                    return;
                }
            }

            Map<Integer, Medal> storeMap = player.medals.get(0);
            if (storeMap.size() >= MedalConst.MEDAL_STORE_LIMIT) {
                handler.sendErrorMsgToPlayer(GameError.MAX_MEDAL_STORE);
                return;
            }
        } else if (exploreType == ComBatConst.Tactics) {//战术
            if (combatId != 1001) {
                if (player.tacticsInfo.getCombatId() < staticExplore.getPreId()) {
                    handler.sendErrorMsgToPlayer(GameError.COMBAT_PASS_BEFORE);
                    return;
                }
            }
        }

        if (!checkExploreCount(player, exploreType)) {
            handler.sendErrorMsgToPlayer(GameError.NO_EXPLORE_COUNT);
            return;
        }

        Form attackForm = PbHelper.createForm(form);

        StaticHero staticHero = null;
        int heroId = 0;
        AwakenHero awakenHero = null;
        Hero hero = null;
        if (attackForm.getAwakenHero() != null) {// 使用觉醒将领
            awakenHero = player.awakenHeros.get(attackForm.getAwakenHero().getKeyId());
            if (awakenHero == null || awakenHero.isUsed()) {
                handler.sendErrorMsgToPlayer(GameError.NO_HERO);
                return;
            }
            attackForm.setAwakenHero(awakenHero.clone());
            heroId = awakenHero.getHeroId();
        } else if (attackForm.getCommander() > 0) {
            hero = player.heros.get(attackForm.getCommander());
            if (hero == null || hero.getCount() <= 0) {
                handler.sendErrorMsgToPlayer(GameError.NO_HERO);
                return;
            }
            heroId = hero.getHeroId();
        }

        if (heroId != 0) {
            staticHero = staticHeroDataMgr.getStaticHero(heroId);
            if (staticHero == null) {
                handler.sendErrorMsgToPlayer(GameError.NO_CONFIG);
                return;
            }

            if (staticHero.getType() != 2) {
                handler.sendErrorMsgToPlayer(GameError.NOT_HERO);
                return;
            }
        }

        int maxTankCount = playerDataManager.formTankCount(player, staticHero, awakenHero);
        if (!playerDataManager.checkTank(player, attackForm, maxTankCount)) {
            handler.sendErrorMsgToPlayer(GameError.TANK_COUNT);
            return;
        }

        //战术验证
        if (!attackForm.getTactics().isEmpty()) {
            boolean checkUseTactics = tacticsService.checkUseTactics(player, attackForm);
            if (!checkUseTactics) {
                handler.sendErrorMsgToPlayer(GameError.USE_TACTICS_ERROR);
                return;
            }
        }


        Fighter attacker = fightService.createFighter(player, attackForm, AttackType.ACK_COMBIT);
        Fighter npc = fightService.createFighter(staticExplore);

        // 配件补给、军工补给、能晶补给活动，攻打能晶，勋章探险关卡伤害加成：30%
        if (exploreType == ComBatConst.Explore_Part) {// 配件探险
            float partSupply = activityDataManager.partSupply(player);
            addSupplyBuff(attacker, partSupply);
        } else if (exploreType == ComBatConst.Explore_Military) {// 军工副本
            float supply = activityDataManager.militarySupply(player);
            addSupplyBuff(attacker, supply);
        } else if (exploreType == ComBatConst.Explore_EnergyStone) {// 能晶副本
            float supply = activityDataManager.energyStoneSupply(player);
            addSupplyBuff(attacker, supply);
        } else if (exploreType == ComBatConst.Explore_Equip) {// 装备副本
            float supply = activityDataManager.equipSupply(player);
            addSupplyBuff(attacker, supply);
        } else if (exploreType == ComBatConst.Explore_Medal) {// 勋章副本
            float supply = activityDataManager.medalSupply(player);
            addSupplyBuff(attacker, supply);
        } else if (exploreType == ComBatConst.Tactics) {// 战术大师副本
            float supply = activityDataManager.tacticsSupply(player);
            addSupplyBuff(attacker, supply);
        }

        DoCombatRs.Builder builder = DoCombatRs.newBuilder();
        FightLogic fightLogic = new FightLogic(attacker, npc, FirstActType.ATTACKER, !wipe);
        fightLogic.fight();

        // PVE战斗免伤亡
        double ratio = player.sciences.containsKey(ScienceId.PVE_HAUST_EXEPMT) ? 1.0 : 0.8;
        Map<Integer, RptTank> haust = haustTank(player, attacker, ratio);

        if (fightLogic.getWinState() == 1) {
            int star = fightLogic.estimateStar();
            builder.addAllAward(dropAward(player, staticExplore.getDrop()));
            builder.addAllAward(dropOneAward(player, staticExplore.getDropOne(), staticExplore.getWeight()));
            builder.addAllAward(dropMaterial(player, staticExplore.getDropMaterial()));

            playerDataManager.activeBoxDrop(player);

            Combat combat = player.explores.get(combatId);
            if (combat == null) {
                combat = new Combat(combatId, star);
                player.explores.put(combatId, combat);
            } else {
                if (star > combat.getStar()) {
                    combat.setStar(star);
                }
            }

            addExploreCount(player.lord, staticExplore.getType());

            playerDataManager.addExp(player, (int) (staticExplore.getExp() * fightService.effectCombatExpAdd(player, staticHero)));

            if (exploreType == ComBatConst.Explore_Equip) {// 装备
                if (combatId > player.equipEplrId) {
                    player.equipEplrId = combatId;
                }
            } else if (exploreType == ComBatConst.Explore_Part) {// 配件
                if (combatId > player.partEplrId) {
                    player.partEplrId = combatId;
                }
            } else if (exploreType == ComBatConst.Explore_Time) {// 限时
                if (combatId > player.timePrlrId) {
                    player.timePrlrId = combatId;
                }
            } else if (exploreType == ComBatConst.Explore_Military) {// 军工
                if (combatId > player.militaryEplrId) {
                    player.militaryEplrId = combatId;
                }
            } else if (exploreType == ComBatConst.Explore_EnergyStone) {// 能晶副本
                if (combatId > player.energyStoneEplrId) {
                    player.energyStoneEplrId = combatId;
                }
            } else if (exploreType == ComBatConst.Explore_Medal) {// 勋章
                if (combatId > player.medalEplrId) {
                    player.medalEplrId = combatId;
                }
            } else if (exploreType == ComBatConst.Tactics) {// 战术
                if (combatId > player.tacticsInfo.getCombatId()) {
                    player.tacticsInfo.setCombatId(combatId);
                }
            }

            if (staticExplore.getExp() != 0) {
                int exp = (int) (staticExplore.getExp() * fightService.effectCombatExpAdd(player, staticHero));
                // playerDataManager.addExp(player, exp);
                int realExp = playerDataManager.realExp(player, exp);
                builder.setExp(realExp);
            }

            builder.setResult(star);
        } else {
            builder.setResult(-1);
        }

        Iterator<RptTank> it = haust.values().iterator();
        while (it.hasNext()) {
            builder.addHaust(PbHelper.createRtpTankPb(it.next()));
        }

        if (!wipe) {
            CommonPb.Record record = fightLogic.generateRecord();
            builder.setRecord(record);
        }

        if (exploreType == ComBatConst.Explore_Equip) {
            playerDataManager.updTask(player, TaskType.COND_EQUIP_EPR, 1, null);
        } else if (exploreType == ComBatConst.Explore_Part && builder.getResult() > 0) {// 挑战配件副本并且胜利
            playerDataManager.updTask(player, TaskType.COND_PART_EPR, 1, null);
        } else if (exploreType == ComBatConst.Explore_Time) {
            playerDataManager.updTask(player, TaskType.COND_LIMIT_COMBAT, 1, null);
        }
        handler.sendMsgToPlayer(DoCombatRs.ext, builder.build());
    }

    /**
     * 极限副本补给buff
     *
     * @param attacker
     * @param supply   void
     */
    private void addSupplyBuff(Fighter attacker, float supply) {
        if (supply != 1f) {
            StaticBuff buff = new StaticBuff();
            buff.setEffectType(4);
            buff.setEffectValue(3000);
            attacker.addAuraAttr(buff);
        }
    }

    /**
     * Method: doExtreme
     *
     * @param req
     * @param handler
     * @return void
     * @Description: 极限探险
     */
    public void doExtreme(DoCombatRq req, ClientHandler handler) {
        int combatId = req.getCombatId();
        CommonPb.Form form = req.getForm();

        StaticExplore staticExplore = staticCombatDataMgr.getStaticExplore(combatId);
        if (staticExplore == null) {
            handler.sendErrorMsgToPlayer(GameError.NO_CONFIG);
            return;
        }

        if (staticExplore.getType() != ComBatConst.Explore_Extreme) {
            handler.sendErrorMsgToPlayer(GameError.INVALID_PARAM);
            return;
        }

        Player player = playerDataManager.getPlayer(handler.getRoleId());

        if (player.wipeTime != 0) {
            handler.sendErrorMsgToPlayer(GameError.IN_WIPE);
            return;
        }

        Map<Integer, Equip> store = player.equips.get(0);
        if (store.size() >= player.lord.getEquip()) {
            handler.sendErrorMsgToPlayer(GameError.MAX_EQUIP_STORE);
            return;
        }

        if (!checkExploreLv(player, staticExplore.getType())) {
            handler.sendErrorMsgToPlayer(GameError.LV_NOT_ENOUGH);
            return;
        }

        if (!checkExploreCount(player, staticExplore.getType())) {
            handler.sendErrorMsgToPlayer(GameError.NO_EXPLORE_COUNT);
            return;
        }

        if (combatId != 301) {
            if (player.extrEplrId < staticExplore.getPreId()) {
                handler.sendErrorMsgToPlayer(GameError.COMBAT_PASS_BEFORE);
                return;
            }
        }

        if (combatId <= player.extrEplrId) {
            handler.sendErrorMsgToPlayer(GameError.HAD_PASS);
            return;
        }

        DoCombatRs.Builder builder = DoCombatRs.newBuilder();
        int result = -1;

        Form attackForm = PbHelper.createForm(form);
        StaticHero staticHero = null;
        int heroId = 0;
        AwakenHero awakenHero = null;
        Hero hero = null;
        if (attackForm.getAwakenHero() != null) {// 使用觉醒将领
            awakenHero = player.awakenHeros.get(attackForm.getAwakenHero().getKeyId());
            if (awakenHero == null || awakenHero.isUsed()) {
                handler.sendErrorMsgToPlayer(GameError.NO_HERO);
                return;
            }
            attackForm.setAwakenHero(awakenHero.clone());
            heroId = awakenHero.getHeroId();
        } else if (attackForm.getCommander() > 0) {
            hero = player.heros.get(attackForm.getCommander());
            if (hero == null || hero.getCount() <= 0) {
                handler.sendErrorMsgToPlayer(GameError.NO_HERO);
                return;
            }
            heroId = hero.getHeroId();
        }

        if (heroId != 0) {
            staticHero = staticHeroDataMgr.getStaticHero(heroId);
            if (staticHero == null) {
                handler.sendErrorMsgToPlayer(GameError.NO_CONFIG);
                return;
            }

            if (staticHero.getType() != 2) {
                handler.sendErrorMsgToPlayer(GameError.NOT_HERO);
                return;
            }
        }

        int maxTankCount = playerDataManager.formTankCount(player, staticHero, awakenHero);
        if (!playerDataManager.checkTank(player, attackForm, maxTankCount)) {
            handler.sendErrorMsgToPlayer(GameError.TANK_COUNT);
            return;
        }

        //战术验证
        if (!attackForm.getTactics().isEmpty()) {
            boolean checkUseTactics = tacticsService.checkUseTactics(player, attackForm);
            if (!checkUseTactics) {
                handler.sendErrorMsgToPlayer(GameError.USE_TACTICS_ERROR);
                return;
            }
        }

        Fighter attacker = fightService.createFighter(player, attackForm, AttackType.ACK_COMBIT);
        Fighter npc = fightService.createFighter(staticExplore);

        FightLogic fightLogic = new FightLogic(attacker, npc, FirstActType.ATTACKER, true);
        fightLogic.packForm(attackForm, PbHelper.createForm(staticExplore.getForm()));
        fightLogic.fight();

        CommonPb.Record record = fightLogic.generateRecord();
        builder.setRecord(record);

        if (fightLogic.getWinState() == 1) {
            result = fightLogic.estimateStar();
        }

        if (result > 0) {
            extremeDataManager.record(combatId, PbHelper.createAtkExtreme(
                    PbHelper.createExtreme(player.lord.getNick(), player.lord.getLevel(), TimeHelper.getCurrentSecond()), record));

            builder.addAllAward(dropAward(player, staticExplore.getDrop()));
            builder.addAllAward(dropOneAward(player, staticExplore.getDropOne(), staticExplore.getWeight()));
            builder.addAllAward(dropMaterial(player, staticExplore.getDropMaterial()));
            player.extrEplrId = combatId;
            if (combatId > player.extrMark) {
                player.extrMark = combatId;
                rankDataManager.setExtreme(player);
            }

        } else {
            addExploreCount(player.lord, staticExplore.getType());
        }

        playerDataManager.updTask(player, TaskType.COND_EXTR_EPR, 1, null);
        builder.setResult(result);
        handler.sendMsgToPlayer(DoCombatRs.ext, builder.build());
    }

    /**
     * Method: addExploreCount
     *
     * @param lord
     * @param type
     * @return void
     * @Description: 增加探险次数
     */
    private void addExploreCount(Lord lord, int type) {
        if (type == ComBatConst.Explore_Equip) {// 装备探险
            lord.setEquipEplr(lord.getEquipEplr() + 1);
        } else if (type == ComBatConst.Explore_Part) {// 配件探险
            lord.setPartEplr(lord.getPartEplr() + 1);
        } else if (type == ComBatConst.Explore_Extreme) {
            lord.setExtrEplr(lord.getExtrEplr() + 1);
        } else if (type == ComBatConst.Explore_Military) {
            lord.setMilitaryEplr(lord.getMilitaryEplr() + 1);
        } else if (type == ComBatConst.Explore_EnergyStone) {// 能晶副本
            lord.setEnergyStoneEplr(lord.getEnergyStoneEplr() + 1);
        } else if (type == ComBatConst.Explore_Medal) {// 勋章探险
            lord.setMedalEplr(lord.getMedalEplr() + 1);
        } else if (type == ComBatConst.Tactics) {
            lord.setTacticsReset(lord.getTacticsReset() + 1);
        } else {
            lord.setTimeEplr(lord.getTimeEplr() + 1);
        }
    }

    /**
     * 掉落物品
     *
     * @param player
     * @param drop
     * @return List<Award>
     */
    private List<Award> dropAward(Player player, List<List<Integer>> drop) {
        List<Award> awards = new ArrayList<>();
        if (drop != null && !drop.isEmpty()) {
            for (List<Integer> award : drop) {
                if (award.size() != 4) {
                    continue;
                }

                int prob = award.get(3);
                if (RandomHelper.isHitRangeIn100(prob)) {
                    int type = award.get(0);
                    int id = award.get(1);
                    int count = award.get(2);
                    int keyId = playerDataManager.addAward(player, type, id, count, AwardFrom.COMBAT_DROP);
                    awards.add(PbHelper.createAwardPb(type, id, count, keyId));
                }
            }
        }
        return awards;
    }

    /**
     * 掉落奖励给玩家
     *
     * @param player
     * @param drop
     * @return List<Award>
     */
    private List<Award> dropCombatAward(Player player, List<List<Integer>> drop) {
        List<Award> awards = new ArrayList<>();
        if (drop != null && !drop.isEmpty()) {
            Map<Integer, List<List<Integer>>> dropMap = new HashMap<Integer, List<List<Integer>>>();
            int count = 0;
            for (List<Integer> award : drop) {
                if (award.size() != 6) {
                    continue;
                }
                int level = award.get(5);
                if (player.lord.getLevel() < level) {
                    continue;
                }
                int grid = award.get(4);
                if (grid > count) {
                    count = grid;
                }
                List<List<Integer>> awardList = dropMap.get(grid);
                if (awardList == null) {
                    awardList = new ArrayList<List<Integer>>();
                    dropMap.put(grid, awardList);
                }
                awardList.add(award);
            }

            for (int i = 0; i < count; i++) {
                List<List<Integer>> awardList = dropMap.get(i + 1);
                if (awardList != null) {
                    int seeds[] = {0, 0};
                    for (List<Integer> e : awardList) {
                        seeds[0] += e.get(3);
                    }
                    seeds[0] = RandomHelper.randomInSize(100);
                    for (List<Integer> e : awardList) {
                        seeds[1] += e.get(3);
                        if (seeds[0] <= seeds[1]) {
                            int itemType = e.get(0);
                            int itemId = e.get(1);
                            int itemCount = e.get(2);
                            int keyId = playerDataManager.addAward(player, itemType, itemId, itemCount, AwardFrom.COMBAT_DROP);
                            awards.add(PbHelper.createAwardPb(itemType, itemId, itemCount, keyId));
                            break;
                        }
                    }
                }
            }
        }
        return awards;
    }

    /**
     * 创建掉落的物品
     *
     * @param drop
     * @return List<Award>
     */
    private List<Award> dropAward(List<List<Integer>> drop) {
        List<Award> awards = new ArrayList<>();
        if (drop != null && !drop.isEmpty()) {
            for (List<Integer> award : drop) {
                if (award.size() != 4) {
                    continue;
                }

                int prob = award.get(3);
                if (RandomHelper.isHitRangeIn100(prob)) {
                    int type = award.get(0);
                    int id = award.get(1);
                    int count = award.get(2);
                    awards.add(PbHelper.createAwardPb(type, id, count));
                }
            }
        }
        return awards;
    }

    /**
     * 根据权重掉落单个奖励 给玩家
     *
     * @param player
     * @param drop
     * @param weight
     * @return List<Award>
     */
    private List<Award> dropOneAward(Player player, List<List<Integer>> drop, int weight) {
        List<Award> awards = new ArrayList<>();
        if (weight <= 0) {
            return awards;
        }
        if (drop != null && !drop.isEmpty()) {
            int prob = RandomHelper.randomInSize(weight);
            int accumulate = 0;
            for (List<Integer> award : drop) {
                int type = award.get(0);
                int id = award.get(1);
                int count = award.get(2);
                accumulate += award.get(3);
                if (prob < accumulate) {
                    int keyId = playerDataManager.addAward(player, type, id, count, AwardFrom.COMBAT_DROP);
                    awards.add(PbHelper.createAwardPb(type, id, count, keyId));
                    break;
                }
            }
        }
        return awards;
    }

    /**
     * 获取根据权重掉落的单个奖励
     *
     * @param drop
     * @param weight
     * @return List<Award>
     */
    private List<Award> dropOneAward(List<List<Integer>> drop, int weight) {
        List<Award> awards = new ArrayList<>();
        if (weight <= 0) {
            return awards;
        }
        if (drop != null && !drop.isEmpty()) {
            int prob = RandomHelper.randomInSize(weight);
            int accumulate = 0;
            for (List<Integer> award : drop) {
                int type = award.get(0);
                int id = award.get(1);
                int count = award.get(2);
                accumulate += award.get(3);
                if (prob < accumulate) {
                    awards.add(PbHelper.createAwardPb(type, id, count));
                    break;
                }
            }
        }
        return awards;
    }

    /**
     * 掉落材料并发给玩家
     *
     * @param player
     * @param drop
     * @return List<Award>
     */
    private List<Award> dropMaterial(Player player, List<List<Integer>> drop) {
        List<Award> awards = new ArrayList<>();
        if (drop != null && !drop.isEmpty()) {
            for (List<Integer> award : drop) {
                if (award.size() != 4) {
                    continue;
                }

                int prob = award.get(3);
                if (RandomHelper.isHitRangeIn100(prob)) {
                    int type = award.get(0);
                    int id = award.get(1);
                    int count = award.get(2);
                    int keyId = playerDataManager.addAward(player, type, id, count, AwardFrom.COMBAT_DROP);
                    awards.add(PbHelper.createAwardPb(type, id, count, keyId));
                    break;
                }
            }
        }
        return awards;
    }

    /**
     * 返回掉落的材料
     *
     * @param drop
     * @return List<Award>
     */
    private List<Award> dropMaterial(List<List<Integer>> drop) {
        List<Award> awards = new ArrayList<>();
        if (drop != null && !drop.isEmpty()) {
            for (List<Integer> award : drop) {
                if (award.size() != 4) {
                    continue;
                }

                int prob = award.get(3);
                if (RandomHelper.isHitRangeIn100(prob)) {
                    int type = award.get(0);
                    int id = award.get(1);
                    int count = award.get(2);
                    awards.add(PbHelper.createAwardPb(type, id, count));
                    break;
                }
            }
        }
        return awards;
    }

    /**
     * 副本首次过关奖励
     *
     * @param player
     * @param drop
     * @param builder void
     */
    private void firstAward(Player player, List<List<Integer>> drop, DoCombatRs.Builder builder) {
        if (drop != null && !drop.isEmpty()) {
            for (List<Integer> award : drop) {
                if (award.size() != 3) {
                    continue;
                }

                int type = award.get(0);
                int id = award.get(1);
                int count = award.get(2);
                int keyId = playerDataManager.addAward(player, type, id, count, AwardFrom.COMBAT_FIRST);
                builder.addAward(PbHelper.createAwardPb(type, id, count, keyId));
            }
        }
    }

    final static private int[] BUY_COST = {98, 148, 198, 248, 298, 298};

    final static int[] BUY_TREASURE_COST = {10, 20, 50};// 显示副本购买次数消耗

    // final static private int[] VIP_LIMIT = { 1, 3, 5, 7, 9, 11 };

    /**
     * 购买装备关卡次数
     *
     * @param player
     * @return int
     */
    private int buyEquipCount(Player player) {
        StaticVip staticVip = staticVipDataMgr.getStaticVip(player.lord.getVip());
        if (staticVip != null) {
            return staticVip.getBuyEquip();
        }

        return 0;
    }

    /**
     * 购买配件关卡次数
     *
     * @param player
     * @return int
     */
    private int buyPartCount(Player player) {
        StaticVip staticVip = staticVipDataMgr.getStaticVip(player.lord.getVip());
        if (staticVip != null) {
            return staticVip.getBuyPart();
        }

        return 0;
    }

    /**
     * 购买军工科技关卡次数
     *
     * @param player
     * @return int
     */
    private int buyMilitaryCount(Player player) {
        StaticVip staticVip = staticVipDataMgr.getStaticVip(player.lord.getVip());
        if (staticVip != null) {
            return staticVip.getBuyMilitary();
        }

        return 0;
    }

    /**
     * 购买能晶关卡次数
     *
     * @param player
     * @return int
     */
    private int buyEnergyCount(Player player) {
        StaticVip staticVip = staticVipDataMgr.getStaticVip(player.lord.getVip());
        if (staticVip != null) {
            return staticVip.getBuyEnergyStone();
        }

        return 0;
    }

    /**
     * 购买限时副本次数
     *
     * @param player
     * @return int
     */
    private int buyTimeCount(Player player) {
        StaticVip staticVip = staticVipDataMgr.getStaticVip(player.lord.getVip());
        if (staticVip != null) {
            return staticVip.getBuyTreasure();
        }
        return 0;
    }

    /**
     * 购买勋章勋章副本次数
     *
     * @param player
     * @return int
     */
    private int buyMedalCount(Player player) {
        StaticVip staticVip = staticVipDataMgr.getStaticVip(player.lord.getVip());
        if (staticVip != null) {
            return staticVip.getBuyMedal();
        }

        return 0;
    }

    /**
     * 购买战术副本次数
     *
     * @param player
     * @return int
     */
    private int buyTacticCount(Player player) {
        StaticVip staticVip = staticVipDataMgr.getStaticVip(player.lord.getVip());
        if (staticVip != null) {
            return staticVip.getBuyTactic();
        }

        return 0;
    }

    /**
     * 购买副本次数消耗金币数量
     *
     * @param count
     * @return int
     */
    private int getBuyCost(int count) {
        if (count >= BUY_COST.length)
            return BUY_COST[BUY_COST.length - 1];
        return BUY_COST[count];
    }

    /**
     * Method: buyExplore
     *
     * @param type
     * @param handler
     * @return void
     * @Description: 购买探险副本次数
     */
    public void buyExplore(int type, ClientHandler handler) {
        Player player = playerDataManager.getPlayer(handler.getRoleId());
        Lord lord = player.lord;
        cleanExplore(lord);
        if (type == 1) {// 装备探险
            int count = lord.getEquipBuy();
            if (count >= buyEquipCount(player)) {
                handler.sendErrorMsgToPlayer(GameError.MAX_BUY_COUNT);
                return;
            }

            // if (lord.getVip() < VIP_LIMIT[count]) {
            // handler.sendErrorMsgToPlayer(GameError.VIP_NOT_ENOUGH);
            // return;
            // }

            int cost = getBuyCost(count);

            float discount = activityDataManager.discountActivity(ActivityConst.ACT_EQUIP_FEED, 0);
            if (discount != 0f && discount != 100f) {
                cost = (int) (cost * discount / 100f);
            }

            if (lord.getGold() < cost) {
                handler.sendErrorMsgToPlayer(GameError.GOLD_NOT_ENOUGH);
                return;
            }

            playerDataManager.subGold(player, cost, AwardFrom.BUY_EXPLORE);
            lord.setEquipBuy(count + 1);

            BuyExploreRs.Builder builder = BuyExploreRs.newBuilder();
            builder.setCount(lord.getEquipBuy());
            builder.setGold(lord.getGold());
            handler.sendMsgToPlayer(BuyExploreRs.ext, builder.build());
        } else if (type == 2) {// 配件探险
            int count = lord.getPartBuy();
            if (count >= buyPartCount(player)) {
                handler.sendErrorMsgToPlayer(GameError.MAX_BUY_COUNT);
                return;
            }

            // if (lord.getVip() < VIP_LIMIT[count]) {
            // handler.sendErrorMsgToPlayer(GameError.VIP_NOT_ENOUGH);
            // return;
            // }

            int cost = getBuyCost(count);
            float costF = activityDataManager.partSupply(player);
            cost *= costF;
            if (lord.getGold() < cost) {
                handler.sendErrorMsgToPlayer(GameError.GOLD_NOT_ENOUGH);
                return;
            }

            playerDataManager.subGold(player, cost, AwardFrom.BUY_EXPLORE);
            lord.setPartBuy(count + 1);

            // playerDataManager.updTask(player, TaskType.COND_PART_EPR, 1, null);
            BuyExploreRs.Builder builder = BuyExploreRs.newBuilder();
            builder.setCount(lord.getPartBuy());
            builder.setGold(lord.getGold());
            handler.sendMsgToPlayer(BuyExploreRs.ext, builder.build());
        } else if (type == 4) {// 限时副本
            int count = lord.getTimeBuy();
            if (count >= buyTimeCount(player)) {
                handler.sendErrorMsgToPlayer(GameError.MAX_BUY_COUNT);
                return;
            }

            int cost = 0;
            if (count >= 3) {// 超过3次（即已购买3次及以上）使用第3次的数值
                cost = BUY_TREASURE_COST[2];
            } else {
                cost = BUY_TREASURE_COST[count];
            }

            if (lord.getGold() < cost) {
                handler.sendErrorMsgToPlayer(GameError.GOLD_NOT_ENOUGH);
                return;
            }

            playerDataManager.subGold(player, cost, AwardFrom.BUY_EXPLORE);
            lord.setTimeBuy(count + 1);

            BuyExploreRs.Builder builder = BuyExploreRs.newBuilder();
            builder.setCount(lord.getTimeBuy());
            builder.setGold(lord.getGold());
            handler.sendMsgToPlayer(BuyExploreRs.ext, builder.build());
        } else if (type == 5) {// 军工探险
            int count = lord.getMilitaryBuy();
            if (count >= buyMilitaryCount(player)) {
                handler.sendErrorMsgToPlayer(GameError.MAX_BUY_COUNT);
                return;
            }

            int cost = getBuyCost(count);
            float costF = activityDataManager.militarySupply(player);
            cost *= costF;

            if (lord.getGold() < cost) {
                handler.sendErrorMsgToPlayer(GameError.GOLD_NOT_ENOUGH);
                return;
            }

            playerDataManager.subGold(player, cost, AwardFrom.BUY_MILITARY);
            lord.setMilitaryBuy(count + 1);

            BuyExploreRs.Builder builder = BuyExploreRs.newBuilder();
            builder.setCount(lord.getMilitaryBuy());
            builder.setGold(lord.getGold());
            handler.sendMsgToPlayer(BuyExploreRs.ext, builder.build());
        } else if (type == 8) {// 能晶副本
            int count = lord.getEnergyStoneBuy();// 已购买次数
            if (count >= buyEnergyCount(player)) {
                handler.sendErrorMsgToPlayer(GameError.MAX_BUY_COUNT);
                return;
            }

            int cost = 0;
            if (count >= 4) {// 超过4次（即已购买4次及以上）使用第4次的数值
                cost = BUY_ENERGY_COST[3];
            } else {
                cost = BUY_ENERGY_COST[count];
            }
            float costF = activityDataManager.energyStoneSupply(player);
            cost *= costF;

            if (lord.getGold() < cost) {
                handler.sendErrorMsgToPlayer(GameError.GOLD_NOT_ENOUGH);
                return;
            }

            playerDataManager.subGold(player, cost, AwardFrom.BUY_ENERGY_STONE);
            lord.setEnergyStoneBuy(count + 1);

            BuyExploreRs.Builder builder = BuyExploreRs.newBuilder();
            builder.setCount(lord.getEnergyStoneBuy());
            builder.setGold(lord.getGold());
            handler.sendMsgToPlayer(BuyExploreRs.ext, builder.build());
        } else if (type == ComBatConst.Explore_Medal) {// 勋章探险
            int count = lord.getMedalBuy();
            if (count >= buyMedalCount(player)) {
                handler.sendErrorMsgToPlayer(GameError.MAX_BUY_COUNT);
                return;
            }

            int cost = getBuyCost(count);
            float costF = activityDataManager.medalSupply(player);
            cost *= costF;
            if (lord.getGold() < cost) {
                handler.sendErrorMsgToPlayer(GameError.GOLD_NOT_ENOUGH);
                return;
            }

            playerDataManager.subGold(player, cost, AwardFrom.BUY_EXPLORE);
            lord.setMedalBuy(count + 1);

            BuyExploreRs.Builder builder = BuyExploreRs.newBuilder();
            builder.setCount(lord.getMedalBuy());
            builder.setGold(lord.getGold());
            handler.sendMsgToPlayer(BuyExploreRs.ext, builder.build());
        } else if (type == ComBatConst.Tactics) {// 战术探险
            int count = lord.getTacticsBuy();
            if (count >= buyTacticCount(player)) {
                handler.sendErrorMsgToPlayer(GameError.MAX_BUY_COUNT);
                return;
            }

            int cost = getBuyCost(count);
            float costF = activityDataManager.tacticsSupply(player);
            cost *= costF;
            if (lord.getGold() < cost) {
                handler.sendErrorMsgToPlayer(GameError.GOLD_NOT_ENOUGH);
                return;
            }

            playerDataManager.subGold(player, cost, AwardFrom.BUY_EXPLORE);
            lord.setTacticsBuy(count + 1);

            BuyExploreRs.Builder builder = BuyExploreRs.newBuilder();
            builder.setCount(lord.getTacticsBuy());
            builder.setGold(lord.getGold());
            handler.sendMsgToPlayer(BuyExploreRs.ext, builder.build());
        }
    }

    /**
     * 购买能晶副本的消耗，超过4次使用第4次的数值
     */
    private static final int[] BUY_ENERGY_COST = {80, 150, 290, 550};

    /**
     * 重置极限探险
     *
     * @param handler void
     */
    public void resetExtrEpr(ClientHandler handler) {
        Player player = playerDataManager.getPlayer(handler.getRoleId());
        Lord lord = player.lord;

        cleanExplore(lord);

        int activityCount = activityNewService.getExtrEprCount();
        if (lord.getExtrReset() >= activityCount + 1) {
            handler.sendErrorMsgToPlayer(GameError.INVALID_PARAM);
            return;
        }


        if (!playerDataManager.subPower(lord, 5)) {
            handler.sendErrorMsgToPlayer(GameError.NO_POWER);
            return;
        }


        player.extrEplrId = 300;
        lord.setExtrReset(lord.getExtrReset() + 1);
        ResetExtrEprRs.Builder builder = ResetExtrEprRs.newBuilder();
        handler.sendMsgToPlayer(ResetExtrEprRs.ext, builder.build());
    }

    private int boxPosValue(int which) {
        return 1 << (which - 1);
    }

    /**
     * Method: getCombatBox
     *
     * @param sectionId
     * @param which
     * @param handler
     * @return void
     * @Description: 领取普通副本章节宝箱
     */
    private void getCombatBox(int sectionId, int which, ClientHandler handler) {
        StaticSection staticSection = staticCombatDataMgr.getStaticSection(sectionId);
        if (staticSection == null) {
            handler.sendErrorMsgToPlayer(GameError.INVALID_PARAM);
            return;
        }

        Player player = playerDataManager.getPlayer(handler.getRoleId());
        Integer boxStatu = player.sections.get(sectionId);
        if (boxStatu != null) {
            if ((boxStatu & boxPosValue(which)) != 0) {
                handler.sendErrorMsgToPlayer(GameError.ALREADY_GET_BOX);
                return;
            }
        } else {
            boxStatu = 0;
        }

        int start = staticSection.getStartId();
        int end = staticSection.getEndId();

        int star = 0;
        for (int i = start; i <= end; i++) {
            Combat combat = player.combats.get(i);
            if (combat != null) {
                star += combat.getStar();
            }
        }

        CombatBoxRs.Builder builder = CombatBoxRs.newBuilder();
        boolean checked = false;

        if (sectionId != 1) {
            if (which == 1) {
                if (star >= 12) {
                    builder.addAllAward(playerDataManager.addAwardsBackPb(player, staticSection.getBox1(), AwardFrom.COMBAT_BOX));
                    checked = true;
                }
            } else if (which == 2) {
                if (star >= 24) {
                    builder.addAllAward(playerDataManager.addAwardsBackPb(player, staticSection.getBox2(), AwardFrom.COMBAT_BOX));
                    checked = true;
                }
            } else if (which == 3) {
                if (star >= 36) {
                    builder.addAllAward(playerDataManager.addAwardsBackPb(player, staticSection.getBox3(), AwardFrom.COMBAT_BOX));
                    checked = true;
                }
            }
        } else {
            if (star >= 33 && which == 1) {
                builder.addAllAward(playerDataManager.addAwardsBackPb(player, staticSection.getBox3(), AwardFrom.COMBAT_BOX));
                checked = true;
            }
        }

        if (checked) {
            player.sections.put(staticSection.getSectionId(), boxStatu | boxPosValue(which));
            handler.sendMsgToPlayer(CombatBoxRs.ext, builder.build());
        } else
            handler.sendErrorMsgToPlayer(GameError.NO_STAR);

    }

    /**
     * 开始扫荡
     *
     * @param handler void
     */
    public void beginWipe(ClientHandler handler) {
        Player player = playerDataManager.getPlayer(handler.getRoleId());
        if (player.lord.getVip() < 3) {
            handler.sendErrorMsgToPlayer(GameError.VIP_NOT_ENOUGH);
            return;
        }

        Map<Integer, Equip> store = player.equips.get(0);
        if (store.size() >= player.lord.getEquip()) {
            handler.sendErrorMsgToPlayer(GameError.MAX_EQUIP_STORE);
            return;
        }

        if (!checkExploreLv(player, 3)) {
            handler.sendErrorMsgToPlayer(GameError.LV_NOT_ENOUGH);
            return;
        }

        // if (!checkExploreCount(player, 3)) {
        // handler.sendErrorMsgToPlayer(GameError.NO_EXPLORE_COUNT);
        // return;
        // }

        if (player.extrEplrId == player.extrMark) {
            handler.sendErrorMsgToPlayer(GameError.COMBAT_PASS_BEFORE);
        }

        if (player.wipeTime != 0) {
            handler.sendErrorMsgToPlayer(GameError.IN_WIPE);
            return;
        }

        player.wipeTime = TimeHelper.getCurrentSecond();

        playerDataManager.updTask(player, TaskType.COND_EXTR_EPR, 1, null);

        BeginWipeRs.Builder builder = BeginWipeRs.newBuilder();
        handler.sendMsgToPlayer(BeginWipeRs.ext, builder.build());
    }

    /**
     * 扫荡结束
     *
     * @param handler void
     */
    public void endWipe(ClientHandler handler) {
        Player player = playerDataManager.getPlayer(handler.getRoleId());
        if (player.wipeTime == 0) {
            handler.sendErrorMsgToPlayer(GameError.NOT_IN_WIPE);
            return;
        }

        cleanExplore(player.lord);

        int now = TimeHelper.getCurrentSecond();
        int count = (now - player.wipeTime) / 30;

        int beginExtr = player.extrEplrId + 1;
        int maxExtr = beginExtr + count;
        maxExtr = maxExtr > player.extrMark ? player.extrMark : maxExtr;

        player.wipeTime = 0;
        player.extrEplrId = maxExtr;

        EndWipeRs.Builder builder = EndWipeRs.newBuilder();
        for (int i = beginExtr; i < maxExtr; i++) {
            StaticExplore staticExplore = staticCombatDataMgr.getStaticExplore(i);
            if (staticExplore != null) {
                builder.addAllAward(dropAward(player, staticExplore.getDrop()));
                builder.addAllAward(dropOneAward(player, staticExplore.getDropOne(), staticExplore.getWeight()));
                builder.addAllAward(dropMaterial(player, staticExplore.getDropMaterial()));
            }
        }

        builder.setCombatId(maxExtr);
        handler.sendMsgToPlayer(EndWipeRs.ext, builder.build());
    }

    /**
     * 装备星级宝箱
     *
     * @param which
     * @param handler void
     */
    private void getEquipBox(int which, ClientHandler handler) {
        StaticSection staticSection = staticCombatDataMgr.getEquipSection();
        if (staticSection == null) {
            handler.sendErrorMsgToPlayer(GameError.NO_CONFIG);
            return;
        }

        Player player = playerDataManager.getPlayer(handler.getRoleId());

        Integer boxStatu = player.sections.get(staticSection.getSectionId());
        if (boxStatu != null) {
            if ((boxStatu & boxPosValue(which)) != 0) {
                handler.sendErrorMsgToPlayer(GameError.ALREADY_GET_BOX);
                return;
            }
        } else {
            boxStatu = 0;
        }

        int star = 0;
        Iterator<Combat> it = player.explores.values().iterator();
        while (it.hasNext()) {
            Combat combat = (Combat) it.next();
            if (combat != null && combat.getCombatId() / 100 == 1) {
                star += combat.getStar();
            }
        }

        CombatBoxRs.Builder builder = CombatBoxRs.newBuilder();
        boolean checked = false;
        List<List<Integer>> awardList = null;
        if (which == 1) {
            if (star >= 12) {
                awardList = staticSection.getBox1();
                // builder.addAllAward(playerDataManager.addAwardsBackPb(player, staticSection.getBox1(),
                // AwardFrom.EQUIP_BOX));
                checked = true;
            }
        } else if (which == 2) {
            if (star >= 24) {
                awardList = staticSection.getBox2();
                // builder.addAllAward(playerDataManager.addAwardsBackPb(player, staticSection.getBox2(),
                // AwardFrom.EQUIP_BOX));
                checked = true;
            }
        } else if (which == 3) {
            if (star >= 36) {
                awardList = staticSection.getBox3();
                // builder.addAllAward(playerDataManager.addAwardsBackPb(player, staticSection.getBox3(),
                // AwardFrom.EQUIP_BOX));
                checked = true;
            }
        }

        // 针对装备和配件类型的奖励，特殊处理
        if (!CheckNull.isEmpty(awardList)) {
            int size = awardList.size();
            for (int i = 0; i < size; i++) {
                List<Integer> e = awardList.get(i);
                int type = e.get(0);
                int itemId = e.get(1);
                int count = e.get(2);
                if (type == AwardType.EQUIP || type == AwardType.PART) {
                    for (int c = 0; c < count; c++) {
                        int itemkey = playerDataManager.addAward(player, type, itemId, 1, AwardFrom.EQUIP_BOX);
                        builder.addAward(PbHelper.createAwardPb(type, itemId, 1, itemkey));
                    }
                } else {
                    int itemkey = playerDataManager.addAward(player, type, itemId, count, AwardFrom.EQUIP_BOX);
                    builder.addAward(PbHelper.createAwardPb(type, itemId, count, itemkey));
                }
            }
        }

        if (checked) {
            player.sections.put(staticSection.getSectionId(), boxStatu | boxPosValue(which));
            handler.sendMsgToPlayer(CombatBoxRs.ext, builder.build());
        } else
            handler.sendErrorMsgToPlayer(GameError.NO_STAR);
    }

    /**
     * 军工星级宝箱
     *
     * @param which
     * @param handler void
     */
    private void getMilitaryBox(int which, ClientHandler handler) {
        StaticSection staticSection = staticCombatDataMgr.getMilitarySection();
        if (staticSection == null) {
            handler.sendErrorMsgToPlayer(GameError.NO_CONFIG);
            return;
        }

        Player player = playerDataManager.getPlayer(handler.getRoleId());
        Integer boxStatu = player.sections.get(staticSection.getSectionId());
        if (boxStatu != null) {
            if ((boxStatu & boxPosValue(which)) != 0) {
                handler.sendErrorMsgToPlayer(GameError.ALREADY_GET_BOX);
                return;
            }
        } else {
            boxStatu = 0;
        }

        int star = 0;
        Iterator<Combat> it = player.explores.values().iterator();
        while (it.hasNext()) {
            Combat combat = (Combat) it.next();
            if (combat != null && combat.getCombatId() / 100 == 5) {
                star += combat.getStar();
            }
        }

        CombatBoxRs.Builder builder = CombatBoxRs.newBuilder();

        boolean checked = false;
        if (which == 1) {
            if (star >= 12) {
                builder.addAllAward(playerDataManager.addAwardsBackPb(player, staticSection.getBox1(), AwardFrom.PART_BOX));
                checked = true;
            }
        } else if (which == 2) {
            if (star >= 24) {
                builder.addAllAward(playerDataManager.addAwardsBackPb(player, staticSection.getBox2(), AwardFrom.PART_BOX));
                checked = true;
            }
        } else if (which == 3) {
            if (star >= 36) {
                builder.addAllAward(playerDataManager.addAwardsBackPb(player, staticSection.getBox3(), AwardFrom.PART_BOX));
                checked = true;
            }
        }

        if (checked) {
            player.sections.put(staticSection.getSectionId(), boxStatu | boxPosValue(which));
            handler.sendMsgToPlayer(CombatBoxRs.ext, builder.build());
        } else
            handler.sendErrorMsgToPlayer(GameError.NO_STAR);
    }

    /**
     * 配件副本星级宝箱
     *
     * @param which
     * @param handler void
     */
    private void getPartBox(int which, ClientHandler handler) {
        StaticSection staticSection = staticCombatDataMgr.getPartSection();
        if (staticSection == null) {
            handler.sendErrorMsgToPlayer(GameError.NO_CONFIG);
            return;
        }

        Player player = playerDataManager.getPlayer(handler.getRoleId());
        Integer boxStatu = player.sections.get(staticSection.getSectionId());
        if (boxStatu != null) {
            if ((boxStatu & boxPosValue(which)) != 0) {
                handler.sendErrorMsgToPlayer(GameError.ALREADY_GET_BOX);
                return;
            }
        } else {
            boxStatu = 0;
        }

        int star = 0;
        Iterator<Combat> it = player.explores.values().iterator();
        while (it.hasNext()) {
            Combat combat = (Combat) it.next();
            if (combat != null && combat.getCombatId() / 100 == 2) {
                star += combat.getStar();
            }
        }

        CombatBoxRs.Builder builder = CombatBoxRs.newBuilder();

        boolean checked = false;
        if (which == 1) {
            if (star >= 12) {
                builder.addAllAward(playerDataManager.addAwardsBackPb(player, staticSection.getBox1(), AwardFrom.PART_BOX));
                checked = true;
            }
        } else if (which == 2) {
            if (star >= 24) {
                builder.addAllAward(playerDataManager.addAwardsBackPb(player, staticSection.getBox2(), AwardFrom.PART_BOX));
                checked = true;
            }
        } else if (which == 3) {
            if (star >= 36) {
                builder.addAllAward(playerDataManager.addAwardsBackPb(player, staticSection.getBox3(), AwardFrom.PART_BOX));
                checked = true;
            }
        }

        if (checked) {
            player.sections.put(staticSection.getSectionId(), boxStatu | boxPosValue(which));
            handler.sendMsgToPlayer(CombatBoxRs.ext, builder.build());
        } else
            handler.sendErrorMsgToPlayer(GameError.NO_STAR);
    }

    /**
     * 荒宝宝箱
     *
     * @param which
     * @param handler void
     */
    private void exchangeTimeBox(int which, ClientHandler handler) {
        int cost = 0;
        int awardId = 0;

        if (which == 1) {
            cost = 10;
            awardId = PropId.HUANGBAO_1;
        } else if (which == 2) {
            cost = 20;
            awardId = PropId.HUANGBAO_2;
        } else if (which == 3) {
            cost = 40;
            awardId = PropId.HUANGBAO_3;
        }

        Player player = playerDataManager.getPlayer(handler.getRoleId());
        if (player.lord.getHuangbao() < cost) {
            handler.sendErrorMsgToPlayer(GameError.HUANGBAO_NOT_ENOUGH);
            return;
        }

        playerDataManager.subHuangbao(player, cost, AwardFrom.HUANGBAO_BOX);

        playerDataManager.addAward(player, AwardType.PROP, awardId, 1, AwardFrom.HUANGBAO_BOX);
        CombatBoxRs.Builder builder = CombatBoxRs.newBuilder();
        builder.addAward(PbHelper.createAwardPb(AwardType.PROP, awardId, 1));
        handler.sendMsgToPlayer(CombatBoxRs.ext, builder.build());
    }

    /**
     * 能晶副本星级宝箱
     *
     * @param which
     * @param handler void
     */
    private void getEnergyStoneBox(int which, ClientHandler handler) {
        StaticSection staticSection = staticCombatDataMgr.getEnergyStoneSection();
        if (staticSection == null) {
            handler.sendErrorMsgToPlayer(GameError.NO_CONFIG);
            return;
        }

        Player player = playerDataManager.getPlayer(handler.getRoleId());
        Integer boxStatu = player.sections.get(staticSection.getSectionId());
        if (boxStatu != null) {
            if ((boxStatu & boxPosValue(which)) != 0) {
                handler.sendErrorMsgToPlayer(GameError.ALREADY_GET_BOX);
                return;
            }
        } else {
            boxStatu = 0;
        }

        int star = 0;
        Iterator<Combat> it = player.explores.values().iterator();
        while (it.hasNext()) {
            Combat combat = (Combat) it.next();
            if (combat != null && combat.getCombatId() / 100 == 8) {
                star += combat.getStar();
            }
        }

        CombatBoxRs.Builder builder = CombatBoxRs.newBuilder();

        boolean checked = false;
        if (which == 1) {
            if (star >= 12) {
                builder.addAllAward(playerDataManager.addAwardsBackPb(player, staticSection.getBox1(), AwardFrom.ENERGY_STONE_BOX));
                checked = true;
            }
        } else if (which == 2) {
            if (star >= 24) {
                builder.addAllAward(playerDataManager.addAwardsBackPb(player, staticSection.getBox2(), AwardFrom.ENERGY_STONE_BOX));
                checked = true;
            }
        } else if (which == 3) {
            if (star >= 36) {
                builder.addAllAward(playerDataManager.addAwardsBackPb(player, staticSection.getBox3(), AwardFrom.ENERGY_STONE_BOX));
                checked = true;
            }
        }

        if (checked) {
            player.sections.put(staticSection.getSectionId(), boxStatu | boxPosValue(which));
            handler.sendMsgToPlayer(CombatBoxRs.ext, builder.build());
        } else
            handler.sendErrorMsgToPlayer(GameError.NO_STAR);
    }

    /**
     * 勋章副本星级宝箱
     *
     * @param which
     * @param handler void
     */
    private void getMedalBox(int which, ClientHandler handler) {
        StaticSection staticSection = staticCombatDataMgr.getMedalSection();
        if (staticSection == null) {
            handler.sendErrorMsgToPlayer(GameError.NO_CONFIG);
            return;
        }

        Player player = playerDataManager.getPlayer(handler.getRoleId());
        Integer boxStatu = player.sections.get(staticSection.getSectionId());
        if (boxStatu != null) {
            if ((boxStatu & boxPosValue(which)) != 0) {
                handler.sendErrorMsgToPlayer(GameError.ALREADY_GET_BOX);
                return;
            }
        } else {
            boxStatu = 0;
        }

        int star = 0;
        Iterator<Combat> it = player.explores.values().iterator();
        while (it.hasNext()) {
            Combat combat = (Combat) it.next();
            if (combat != null && combat.getCombatId() / 100 == 9) {
                star += combat.getStar();
            }
        }

        CombatBoxRs.Builder builder = CombatBoxRs.newBuilder();

        boolean checked = false;
        if (which == 1) {
            if (star >= 12) {
                builder.addAllAward(playerDataManager.addAwardsBackPb(player, staticSection.getBox1(), AwardFrom.MEDAL_BOX));
                checked = true;
            }
        } else if (which == 2) {
            if (star >= 24) {
                builder.addAllAward(playerDataManager.addAwardsBackPb(player, staticSection.getBox2(), AwardFrom.MEDAL_BOX));
                checked = true;
            }
        } else if (which == 3) {
            if (star >= 36) {
                builder.addAllAward(playerDataManager.addAwardsBackPb(player, staticSection.getBox3(), AwardFrom.MEDAL_BOX));
                checked = true;
            }
        }

        if (checked) {
            player.sections.put(staticSection.getSectionId(), boxStatu | boxPosValue(which));
            handler.sendMsgToPlayer(CombatBoxRs.ext, builder.build());
        } else
            handler.sendErrorMsgToPlayer(GameError.NO_STAR);
    }


    /**
     * 战术副本星级宝箱
     *
     * @param which
     * @param handler void
     */
    private void getTacticsBox(int which, ClientHandler handler) {
        StaticSection staticSection = staticCombatDataMgr.getTacticsSection();
        if (staticSection == null) {
            handler.sendErrorMsgToPlayer(GameError.NO_CONFIG);
            return;
        }

        Player player = playerDataManager.getPlayer(handler.getRoleId());
        Integer boxStatu = player.sections.get(staticSection.getSectionId());
        if (boxStatu != null) {
            if ((boxStatu & boxPosValue(which)) != 0) {
                handler.sendErrorMsgToPlayer(GameError.ALREADY_GET_BOX);
                return;
            }
        } else {
            boxStatu = 0;
        }

        int star = 0;
        Iterator<Combat> it = player.explores.values().iterator();
        while (it.hasNext()) {
            Combat combat = (Combat) it.next();
            if (combat != null && combat.getCombatId() / 100 == 10) {
                star += combat.getStar();
            }
        }

        CombatBoxRs.Builder builder = CombatBoxRs.newBuilder();

        boolean checked = false;
        if (which == 1) {
            if (star >= 12) {
                builder.addAllAward(playerDataManager.addAwardsBackPb(player, staticSection.getBox1(), AwardFrom.TACTICS_BOX));
                checked = true;
            }
        } else if (which == 2) {
            if (star >= 24) {
                builder.addAllAward(playerDataManager.addAwardsBackPb(player, staticSection.getBox2(), AwardFrom.TACTICS_BOX));
                checked = true;
            }
        } else if (which == 3) {
            if (star >= 36) {
                builder.addAllAward(playerDataManager.addAwardsBackPb(player, staticSection.getBox3(), AwardFrom.TACTICS_BOX));
                checked = true;
            }
        }

        if (checked) {
            player.sections.put(staticSection.getSectionId(), boxStatu | boxPosValue(which));
            handler.sendMsgToPlayer(CombatBoxRs.ext, builder.build());
        } else
            handler.sendErrorMsgToPlayer(GameError.NO_STAR);
    }

    /**
     * Method: combatBox
     *
     * @param req
     * @param handler
     * @return void
     * @Description: 领取副本星级宝箱
     */
    public void combatBox(CombatBoxRq req, ClientHandler handler) {
        int type = req.getType();
        int id = req.getId();
        int which = req.getWhich();
        if (which < 0 || which > 3) {
            handler.sendErrorMsgToPlayer(GameError.INVALID_PARAM);
            return;
        }

        if (type == 1) {
            getCombatBox(id, which, handler);
        } else if (type == 2) {
            getEquipBox(which, handler);
        } else if (type == 3) {
            getPartBox(which, handler);
        } else if (type == 4) {
            exchangeTimeBox(which, handler);
        } else if (type == 6) {
            getMilitaryBox(which, handler);
        } else if (type == 8) {
            getEnergyStoneBox(which, handler);
        } else if (type == ComBatConst.Explore_Medal) {
            getMedalBox(which, handler);
        } else if (type == ComBatConst.Tactics) {
            getTacticsBox(which, handler);
        }
    }

    /**
     * 获取极限探险记录
     *
     * @param extremeId
     * @param handler   void
     */
    public void getExtreme(int extremeId, ClientHandler handler) {
        Extreme extreme = extremeDataManager.getExtreme(extremeId);
        if (extreme == null) {
            handler.sendErrorMsgToPlayer(GameError.NO_CONFIG);
            return;
        }

        GetExtremeRs.Builder builder = GetExtremeRs.newBuilder();
        AtkExtreme first = extreme.getFirst1();
        if (first != null) {
            builder.setFirst(first.getAttacker());
        }

        for (AtkExtreme e : extreme.getLast3()) {
            builder.addLast3(e.getAttacker());
        }

        handler.sendMsgToPlayer(GetExtremeRs.ext, builder.build());

    }

    /**
     * 观看某个极限探险记录
     *
     * @param req
     * @param handler void
     */
    public void extremeRecord(ExtremeRecordRq req, ClientHandler handler) {
        int extremeId = req.getExtremeId();
        int which = req.getWhich();
        Extreme extreme = extremeDataManager.getExtreme(extremeId);
        if (extreme == null) {
            handler.sendErrorMsgToPlayer(GameError.NO_CONFIG);
            return;
        }

        if (which < 0) {
            handler.sendErrorMsgToPlayer(GameError.INVALID_PARAM);
            return;
        }

        ExtremeRecordRs.Builder builder = ExtremeRecordRs.newBuilder();
        if (which == 0) {
            if (extreme.getFirst1() != null) {
                builder.setRecord(extreme.getFirst1().getRecord());
            }
        } else {
            int index = 0;
            for (AtkExtreme e : extreme.getLast3()) {
                index++;
                if (which == index) {
                    builder.setRecord(e.getRecord());
                }
            }
        }

        handler.sendMsgToPlayer(ExtremeRecordRs.ext, builder.build());
    }

    /**
     * 定时保存极限探险记录 void
     */
    public void saveExtremeTimerLogic() {
        Iterator<Integer> it = extremeDataManager.saveSet.iterator();
        Map<Integer, Extreme> map = extremeDataManager.recordMap;
        int saveCount = 0;
        while (it.hasNext()) {
            Integer id = (Integer) it.next();
            Extreme extreme = map.get(id);
            if (extreme != null) {
                saveCount++;
                try {
                    GameServer.getInstance().saveExtremeServer.saveData(extremeDataManager.serExtreme(extreme));
                } catch (Exception e) {
                    LogUtil.error("save extreme {" + id + "} data error", e);
                }
            }
        }

        extremeDataManager.saveSet.clear();

        if (saveCount != 0) {
            LogUtil.save("save extreme count:" + saveCount);
        }
    }

    /**
     * 扫荡完成获得奖励
     *
     * @param player
     * @param now    void
     */
    public void checkWipe(Player player, int now) {
        int count = (now - player.wipeTime) / 30;
        int beginExtr = player.extrEplrId + 1;
        int maxExtr = beginExtr + count;
        if (maxExtr >= player.extrMark) {
            List<Award> awards = new ArrayList<>();
            for (int i = beginExtr; i <= player.extrMark; i++) {
                StaticExplore staticExplore = staticCombatDataMgr.getStaticExplore(i);
                if (staticExplore != null) {
                    awards.addAll(dropAward(staticExplore.getDrop()));
                    awards.addAll(dropOneAward(staticExplore.getDropOne(), staticExplore.getWeight()));
                    awards.addAll(dropMaterial(staticExplore.getDropMaterial()));
                }
            }

            awards = repeateAwardHand(player, awards);

            player.wipeTime = 0;
            player.extrEplrId = player.extrMark;
            playerDataManager.sendAttachMail(AwardFrom.GM_SEND, player, awards, MailType.MOLD_WIPE, now, String.valueOf(count + 1));
        }
    }

    /**
     * 合并重复道
     *
     * @param player
     * @param awards
     * @return List<Award>
     */
    public List<Award> repeateAwardHand(Player player, List<Award> awards) {
        if (awards == null || awards.isEmpty())
            return awards;
        // 合并重复道具（注意此处因为不会有唯一ID的award）
        Map<Integer, Map<Integer, Long>> awardMap = new HashMap<>();
        // 有唯一ID的道具不能被合并(装备,军备,觉醒将领...)
        List<Award> keyIdAward = new ArrayList<>();
        // StringBuilder oldSb = new StringBuilder();
        for (Award award : awards) {
            if (isKeyIdAward(award.getType())) {
                keyIdAward.add(award);
            } else {
                Map<Integer, Long> idMap = awardMap.get(award.getType());
                if (idMap == null) {
                    awardMap.put(award.getType(), idMap = new HashMap<Integer, Long>());
                }
                Long oldCnt = idMap.get(award.getId());
                idMap.put(award.getId(), award.getCount() + (oldCnt != null ? oldCnt : 0));

            }
            // oldSb.append(award.getType()).append("_")
            // .append(award.getId()).append("_")
            // .append(award.getCount()).append("_")
            // .append(award.getKeyId()).append(",");
        }

        List<Award> notRepteatAwards = new ArrayList<>();
        for (Map.Entry<Integer, Map<Integer, Long>> entry : awardMap.entrySet()) {
            for (Map.Entry<Integer, Long> award : entry.getValue().entrySet()) {
                notRepteatAwards.add(PbHelper.createAwardPb(entry.getKey(), award.getKey(), award.getValue()));
            }
        }
        if (!keyIdAward.isEmpty()) {
            notRepteatAwards.addAll(keyIdAward);
        }

        // StringBuilder newSb = new StringBuilder();
        // for (Award award : notRepteatAwards) {
        // newSb.append(award.getType()).append("_")
        // .append(award.getId()).append("_")
        // .append(award.getCount()).append("_")
        // .append(award.getKeyId()).append(",");
        // }
        // if (awards.size() != notRepteatAwards.size()) {
        // LogUtil.common(String.format("lordId :%d, \n old award :%s \n new award :%s", player.roleId,
        // oldSb.toString(), newSb.toString()));
        // }
        return notRepteatAwards;
    }

    /**
     * 是否拥有唯一主键的奖励类型
     *
     * @param type
     * @return
     */
    private boolean isKeyIdAward(int type) {
        return type == AwardType.EQUIP || type == AwardType.PART || type == AwardType.HERO || type == AwardType.MEDAL
                || type == AwardType.AWARK_HERO || type == AwardType.LORD_EQUIP;
    }


    /**
     * 获取扫荡设置信息
     *
     * @param rq
     * @param handler
     */
    public void getWipeInfoRq(GamePb6.GetWipeInfoRq rq, ClientHandler handler) {
        Player player = playerDataManager.getPlayer(handler.getRoleId());
        Map<Integer, WipeInfo> wipeInfo = player.wipeInfo;

        GamePb6.GetWipeInfoRs.Builder builder = GamePb6.GetWipeInfoRs.newBuilder();

        for (WipeInfo info : wipeInfo.values()) {
            builder.addInfo(PbHelper.createWipeInfo(info));
        }

        handler.sendMsgToPlayer(GamePb6.GetWipeInfoRs.ext, builder.build());

    }


    /**
     * 设置信息
     *
     * @param rq
     * @param handler
     */
    public void setWipeInfoRq(GamePb6.SetWipeInfoRq rq, ClientHandler handler) {
        Player player = playerDataManager.getPlayer(handler.getRoleId());
        Lord lord = player.lord;
        List<CommonPb.WipeInfo> infoList = rq.getInfoList();

        if (infoList.size() < 0 || infoList.size() > 7) {
            handler.sendErrorMsgToPlayer(GameError.PARAM_ERROR);
            return;
        }

        List<Integer> list = new ArrayList<>();
        list.add(1);
        list.add(2);
        list.add(5);
        list.add(8);
        list.add(9);
        list.add(10);

        for (CommonPb.WipeInfo w : infoList) {
            if (!list.contains(w.getExploreType())) {
                handler.sendErrorMsgToPlayer(GameError.PARAM_ERROR);
                return;
            }
        }

        for (CommonPb.WipeInfo w : infoList) {
            int type = w.getExploreType();
            int buyCount = w.getBuyCount();
            Combat combat = player.explores.get(w.getCombatId());


            //星级验证
            if (combat.getStar() != 3) {
                handler.sendErrorMsgToPlayer(GameError.PARAM_ERROR);
                return;
            }


            //次数验证
            if (type == 1) {// 装备探险
                int count = lord.getEquipBuy() + buyCount;
                if (count > buyEquipCount(player)) {
                    handler.sendErrorMsgToPlayer(GameError.WIPE_COMBAT);
                    return;
                }

            } else if (type == 2) {// 配件探险
                int count = lord.getPartBuy() + buyCount;
                if (count > buyPartCount(player)) {
                    handler.sendErrorMsgToPlayer(GameError.WIPE_COMBAT);
                    return;
                }

            } else if (type == 5) {// 军工探险
                int count = lord.getMilitaryBuy() + buyCount;
                if (count > buyMilitaryCount(player)) {
                    handler.sendErrorMsgToPlayer(GameError.WIPE_COMBAT);
                    return;
                }

            } else if (type == 8) {// 能晶副本
                int count = lord.getEnergyStoneBuy() + buyCount;// 已购买次数
                if (count > buyEnergyCount(player)) {
                    handler.sendErrorMsgToPlayer(GameError.WIPE_COMBAT);
                    return;
                }

            } else if (type == ComBatConst.Explore_Medal) {// 勋章探险
                int count = lord.getMedalBuy() + buyCount;
                if (count > buyMedalCount(player)) {
                    handler.sendErrorMsgToPlayer(GameError.WIPE_COMBAT);
                    return;
                }

            } else if (type == ComBatConst.Tactics) {// 战术探险
                int count = lord.getTacticsBuy() + buyCount;
                if (count > buyTacticCount(player)) {
                    handler.sendErrorMsgToPlayer(GameError.WIPE_COMBAT);
                    return;
                }
            }

        }

        player.wipeInfo.clear();

        for (CommonPb.WipeInfo winfo : infoList) {
            player.wipeInfo.put(winfo.getExploreType(), new WipeInfo(winfo));
        }

        GamePb6.SetWipeInfoRs.Builder builder = GamePb6.SetWipeInfoRs.newBuilder();

        for (WipeInfo info : player.wipeInfo.values()) {
            builder.addInfo(PbHelper.createWipeInfo(info));
        }

        handler.sendMsgToPlayer(GamePb6.SetWipeInfoRs.ext, builder.build());

    }


    /**
     * 扫荡
     *
     * @param rq
     * @param handler
     */
    public void getWipeRewarRq(GamePb6.GetWipeRewarRq rq, ClientHandler handler) {
        Player player = playerDataManager.getPlayer(handler.getRoleId());
        Lord lord = player.lord;
        cleanExplore(lord);


        Map<Integer, WipeInfo> wipeInfo = player.wipeInfo;

        int gold = 0;

        for (WipeInfo winfo : wipeInfo.values()) {
            int type = winfo.getExploreType();
            int buyCount = winfo.getBuyCount();
            Combat combat = player.explores.get(winfo.getCombatId());

            //星级验证
            if (combat.getStar() != 3) {
                handler.sendErrorMsgToPlayer(GameError.PARAM_ERROR);
                return;
            }
            // 装备探险
            if (type == 1) {
                if (getCount(player, type) > 0 || buyCount > 0) {
                    Map<Integer, Equip> equipsMap = player.equips.get(0);
                    if (equipsMap.size() >= player.lord.getEquip()) {
                        handler.sendErrorMsgToPlayer(GameError.MAX_EQUIP_STORE);
                        return;
                    }
                }


                int count = lord.getEquipBuy() + buyCount;
                if (count > buyEquipCount(player)) {
                    handler.sendErrorMsgToPlayer(GameError.WIPE_COMBAT);
                    return;
                }

                for (int a = lord.getEquipBuy(); a < count; a++) {
                    int cost = getBuyCost(a);
                    float discount = activityDataManager.discountActivity(ActivityConst.ACT_EQUIP_FEED, 0);
                    if (discount != 0f && discount != 100f) {
                        cost = (int) (cost * discount / 100f);
                    }
                    gold += cost;
                }

                // 配件探险
            } else if (type == 2) {

                if (getCount(player, type) > 0 || buyCount > 0) {
                    Map<Integer, Part> storeMap = player.parts.get(0);
                    if (storeMap.size() >= PlayerDataManager.PART_STORE_LIMIT) {
                        handler.sendErrorMsgToPlayer(GameError.MAX_PART_STORE);
                        return;
                    }
                }


                int count = lord.getPartBuy() + buyCount;
                if (count > buyPartCount(player)) {
                    handler.sendErrorMsgToPlayer(GameError.WIPE_COMBAT);
                    return;
                }

                for (int a = lord.getPartBuy(); a < count; a++) {
                    int cost = getBuyCost(a);
                    float costF = activityDataManager.partSupply(player);
                    cost *= costF;
                    gold += cost;
                }

                // 军工探险
            } else if (type == 5) {
                int count = lord.getMilitaryBuy() + buyCount;
                if (count > buyMilitaryCount(player)) {
                    handler.sendErrorMsgToPlayer(GameError.WIPE_COMBAT);
                    return;
                }


                for (int a = lord.getMilitaryBuy(); a < count; a++) {
                    int cost = getBuyCost(a);
                    float costF = activityDataManager.militarySupply(player);
                    cost *= costF;

                    gold += cost;
                }
                // 能晶副本
            } else if (type == 8) {
                int count = lord.getEnergyStoneBuy() + buyCount;// 已购买次数
                if (count > buyEnergyCount(player)) {
                    handler.sendErrorMsgToPlayer(GameError.WIPE_COMBAT);
                    return;
                }
                for (int a = lord.getEnergyStoneBuy(); a < count; a++) {
                    int cost = 0;
                    if (a >= 4) {// 超过4次（即已购买4次及以上）使用第4次的数值
                        cost = BUY_ENERGY_COST[3];
                    } else {
                        cost = BUY_ENERGY_COST[a];
                    }
                    float costF = activityDataManager.energyStoneSupply(player);
                    cost *= costF;
                    gold += cost;
                }
                // 勋章探险
            } else if (type == ComBatConst.Explore_Medal) {

                if (getCount(player, type) > 0 || buyCount > 0) {
                    Map<Integer, Medal> medalsMap = player.medals.get(0);
                    if (medalsMap.size() >= MedalConst.MEDAL_STORE_LIMIT) {
                        handler.sendErrorMsgToPlayer(GameError.MAX_MEDAL_STORE);
                        return;
                    }
                }


                int count = lord.getMedalBuy() + buyCount;
                if (count > buyMedalCount(player)) {
                    handler.sendErrorMsgToPlayer(GameError.WIPE_COMBAT);
                    return;
                }
                for (int a = lord.getMedalBuy(); a < count; a++) {
                    int cost = getBuyCost(a);
                    float costF = activityDataManager.medalSupply(player);
                    cost *= costF;
                    gold += cost;
                }

            } else if (type == ComBatConst.Tactics) {// 战术探险
                int count = lord.getTacticsBuy() + buyCount;
                if (count > buyTacticCount(player)) {
                    handler.sendErrorMsgToPlayer(GameError.WIPE_COMBAT);
                    return;
                }
                for (int a = lord.getTacticsBuy(); a < count; a++) {
                    int cost = getBuyCost(a);
                    float costF = activityDataManager.tacticsSupply(player);
                    cost *= costF;
                    gold += cost;
                }

            }

        }
        if (lord.getGold() < gold) {
            handler.sendErrorMsgToPlayer(GameError.GOLD_NOT_ENOUGH);
            return;
        }

        playerDataManager.subGold(player, gold, AwardFrom.WIPE_DECR);

        for (WipeInfo winfo : wipeInfo.values()) {
            int type = winfo.getExploreType();
            int buyCount = winfo.getBuyCount();


            if (type == 1) {// 装备探险
                int count = lord.getEquipBuy();
                lord.setEquipBuy(count + buyCount);

            } else if (type == 2) {// 配件探险
                int count = lord.getPartBuy();
                lord.setPartBuy(count + buyCount);

            } else if (type == 5) {// 军工探险
                int count = lord.getMilitaryBuy();
                lord.setMilitaryBuy(count + buyCount);
            } else if (type == 8) {// 能晶副本
                int count = lord.getEnergyStoneBuy();// 已购买次数
                lord.setEnergyStoneBuy(count + buyCount);

            } else if (type == ComBatConst.Explore_Medal) {// 勋章探险
                int count = lord.getMedalBuy();
                lord.setMedalBuy(count + buyCount);

            } else if (type == ComBatConst.Tactics) {// 战术探险
                int count = lord.getTacticsBuy();
                lord.setTacticsBuy(count + buyCount);

            }

        }


        GamePb6.GetWipeRewarRs.Builder builder = GamePb6.GetWipeRewarRs.newBuilder();

        for (WipeInfo winfo : wipeInfo.values()) {
            int type = winfo.getExploreType();
            int count = getCount(player, type);
            if (count > 0) {


                CommonPb.WipeRewardInfo.Builder builder1 = CommonPb.WipeRewardInfo.newBuilder();
                long exp = 0;

                Map<Integer, Map<Integer, Long>> rew = new HashMap<>();
                List<Award> awardList = new ArrayList<>();


                for (int i = 1; i <= count; i++) {

                    StaticExplore staticExplore = staticCombatDataMgr.getStaticExplore(winfo.getCombatId());
                    List<Award> awards = dropAward(player, staticExplore.getDrop());
                    if (awards != null && !awards.isEmpty()) {
                        awardList.addAll(awards);
                    }

                    List<Award> awards1 = dropOneAward(player, staticExplore.getDropOne(), staticExplore.getWeight());

                    if (awards1 != null && !awards1.isEmpty()) {
                        awardList.addAll(awards1);
                    }

                    List<Award> awards2 = dropMaterial(player, staticExplore.getDropMaterial());

                    if (awards2 != null && !awards2.isEmpty()) {
                        awardList.addAll(awards2);
                    }

                    playerDataManager.activeBoxDrop(player);

                    addExploreCount(player.lord, staticExplore.getType());

                    int expTemp = (int) (staticExplore.getExp() * fightService.effectCombatExpAdd(player, null));
                    playerDataManager.addExp(player, expTemp);

                    int realExp = playerDataManager.realExp(player, expTemp);
                    exp = exp + realExp;

                    if (type == ComBatConst.Explore_Part) {
                        playerDataManager.updTask(player, TaskType.COND_PART_EPR, 1, null);
                    }
                    if (type == ComBatConst.Explore_Equip) {
                        playerDataManager.updTask(player, TaskType.COND_EQUIP_EPR, 1, null);
                    }
                }


                //汇总物品给客户端显示
                if (!awardList.isEmpty()) {
                    for (Award award : awardList) {
                        int awardId = award.getId();
                        int awardType = award.getType();
                        long awardCount = award.getCount();
                        int awardKeyId = award.getKeyId();

                        if (awardKeyId > 0) {
                            builder1.addAward(award);
                        } else {

                            if (!rew.containsKey(awardType)) {
                                rew.put(awardType, new HashMap<Integer, Long>());
                            }

                            Map<Integer, Long> itemMap = rew.get(awardType);

                            if (!itemMap.containsKey(awardId)) {
                                itemMap.put(awardId, 0l);
                            }
                            itemMap.put(awardId, itemMap.get(awardId) + awardCount);
                        }

                    }
                }

                builder1.setExp(exp);
                builder1.setExploreType(type);

                for (Integer awardType : rew.keySet()) {
                    Map<Integer, Long> integerLongMap = rew.get(awardType);
                    Set<Map.Entry<Integer, Long>> entries = integerLongMap.entrySet();
                    for (Map.Entry<Integer, Long> e : entries) {

                        int awardId = e.getKey();
                        long awardCount = e.getValue();
                        builder1.addAward(PbHelper.createAwardPb(awardType, awardId, awardCount, 0));
                    }

                }

                builder.addRewardInfo(builder1.build());
            }
        }
        builder.setGold(lord.getGold());

        builder.setEquipEplr(lord.getEquipEplr());
        builder.setPartEplr(lord.getPartEplr());
        builder.setMilitaryEplr(lord.getMilitaryEplr());
        builder.setEquipBuy(lord.getEquipBuy());
        builder.setPartBuy(lord.getPartBuy());
        builder.setMilitaryBuy(lord.getMilitaryBuy());
        builder.setEnergyStoneEplrId(lord.getEnergyStoneEplr());
        builder.setEnergyStoneBuy(lord.getEnergyStoneBuy());
        builder.setMedalEplr(lord.getMedalEplr());
        builder.setMedalBuy(lord.getMedalBuy());
        builder.setTacticsBuy(lord.getTacticsBuy());
        builder.setTacticsReset(lord.getTacticsReset());

        handler.sendMsgToPlayer(GamePb6.GetWipeRewarRs.ext, builder.build());

    }


    /**
     * 获取可以扫荡次数
     *
     * @param player
     * @param type
     * @return
     */
    private int getCount(Player player, int type) {
        Lord lord = player.lord;
        cleanExplore(lord);
        if (type == ComBatConst.Explore_Equip) {// 装备探险
            int add = activityDataManager.freeLotEquip();
            return (5 + lord.getEquipBuy() * 5 + add) - lord.getEquipEplr();
        } else if (type == ComBatConst.Explore_Part) {// 配件探险
            int add = activityDataManager.freeLotPart();
            return (5 + lord.getPartBuy() * 5 + add) - lord.getPartEplr();
        } else if (type == ComBatConst.Explore_Military) {// 军工探险
            int add = activityDataManager.freeLotMilitary(); // 活动
            return (5 + lord.getMilitaryBuy() * 5 + add) - lord.getMilitaryEplr();
        } else if (type == ComBatConst.Explore_Time) {// 限时副本
            return (5 + lord.getTimeBuy() * 5) - lord.getTimeEplr();
        } else if (type == ComBatConst.Explore_EnergyStone) {// 能晶副本，VIP买一次加5挑战次数
            int add = activityDataManager.freeLotEnergyStone(); // 活动
            return (5 + lord.getEnergyStoneBuy() * 5 + add) - lord.getEnergyStoneEplr();
        } else if (type == ComBatConst.Explore_Medal) {// 勋章探险
            int add = activityDataManager.freeLotMedal();
            return (5 + lord.getMedalBuy() * 5 + add) - lord.getMedalEplr();
        } else if (type == ComBatConst.Tactics) {// 战术探险
            int add = activityDataManager.freeLotTactics();
            return (5 + lord.getTacticsBuy() * 5 + add) - lord.getTacticsReset();
        }
        return 0;
    }


}
